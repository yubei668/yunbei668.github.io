<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="description" content="光遇人格测试，探索你在天空王国中的真实性格">
  <title>光遇人格测试 | 探索你的天空特质</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- 自定义配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4A90E2', // 主色调：天空蓝
            secondary: '#FFC107', // 辅助色：烛光黄
            accent: '#8BC34A', // 强调色：青草绿
            neutral: '#F5F7FA', // 中性色：浅灰
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary text-white py-3 px-8 rounded-full font-medium transition-all duration-300 hover:bg-primary/90 hover:shadow-lg active:scale-95;
      }
      .btn-secondary {
        @apply bg-white text-primary border border-primary py-3 px-8 rounded-full font-medium transition-all duration-300 hover:bg-primary/5 active:scale-95;
      }
      .watermark {
        position: fixed;
        bottom: 20px;
        right: 20px;
        opacity: 0.15;
        font-size: 1.5rem;
        font-weight: bold;
        color: #4A90E2;
        transform: rotate(15deg);
        pointer-events: none;
        z-index: 10;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-b from-blue-50 to-indigo-50 min-h-screen font-sans text-gray-800 overflow-x-hidden">
  <!-- 水印 -->
  <div class="watermark">sky小贝制作</div>
  
  <!-- 页面加载动画 -->
  <div id="loader" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
    <div class="w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin mb-4"></div>
    <p class="text-primary font-medium">加载中...</p>
  </div>

  <!-- 顶部导航栏 -->
  <header class="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-sm z-40 shadow-sm transition-all duration-300" id="header">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <h1 class="text-xl font-bold text-primary flex items-center">
        <i class="fa fa-star mr-2 text-secondary"></i>
        <span>光遇人格测试</span>
      </h1>
      <button id="shareBtn" class="text-gray-600 hover:text-primary transition-colors">
        <i class="fa fa-share-alt text-lg"></i>
      </button>
    </div>
  </header>

  <main class="container mx-auto px-4 pt-24 pb-20">
    <!-- 欢迎页面 -->
    <section id="welcomePage" class="block">
      <div class="max-w-md mx-auto text-center">
        <div class="relative mb-8">
          <div class="w-32 h-32 bg-gradient-to-r from-primary to-accent rounded-full mx-auto flex items-center justify-center shadow-lg">
            <i class="fa fa-paper-plane text-white text-4xl"></i>
          </div>
          <div class="absolute -bottom-2 -right-2 w-10 h-10 bg-secondary rounded-full flex items-center justify-center shadow-md">
            <i class="fa fa-lightbulb-o text-white"></i>
          </div>
        </div>
        
        <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-4 text-shadow">
          探索你在天空王国中的<br>真实特质
        </h2>
        <p class="text-gray-600 mb-8 leading-relaxed">
          通过20道精心设计的题目，发现你在光遇世界中独特的人格特质，
          了解你与这个奇妙世界的连接方式。
        </p>
        
        <div class="space-y-4">
          <button id="startTestBtn" class="btn-primary w-full">
            开始测试
          </button>
          <p class="text-sm text-gray-500">
            <i class="fa fa-lock mr-1"></i> 测试结果仅你可见
          </p>
        </div>
        
        <div class="mt-12 grid grid-cols-3 gap-4">
          <div class="bg-white rounded-xl p-4 card-hover">
            <div class="text-primary text-2xl mb-2"><i class="fa fa-list-ol"></i></div>
            <h3 class="font-medium text-sm">20道题目</h3>
            <p class="text-xs text-gray-500">深度检测</p>
          </div>
          <div class="bg-white rounded-xl p-4 card-hover">
            <div class="text-secondary text-2xl mb-2"><i class="fa fa-area-chart"></i></div>
            <h3 class="font-medium text-sm">特质分析</h3>
            <p class="text-xs text-gray-500">多维解读</p>
          </div>
          <div class="bg-white rounded-xl p-4 card-hover">
            <div class="text-accent text-2xl mb-2"><i class="fa fa-star-o"></i></div>
            <h3 class="font-medium text-sm">专属称号</h3>
            <p class="text-xs text-gray-500">光遇身份</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 测试页面 -->
    <section id="testPage" class="hidden">
      <div class="max-w-md mx-auto">
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
          <div class="flex justify-between items-center mb-6">
            <span class="text-sm font-medium text-gray-500">
              问题 <span id="currentQuestion">1</span>/<span id="totalQuestions">20</span>
            </span>
            <div class="w-24 bg-gray-200 rounded-full h-2">
              <div id="progressBar" class="bg-primary h-2 rounded-full" style="width: 5%"></div>
            </div>
          </div>
          
          <h3 id="questionText" class="text-xl font-bold mb-8 text-center">
            问题加载中...
          </h3>
          
          <div id="optionsContainer" class="space-y-3">
            <!-- 选项将通过JS动态生成 -->
          </div>
        </div>
        
        <div class="flex justify-between">
          <button id="prevBtn" class="btn-secondary opacity-50 cursor-not-allowed" disabled>
            上一题
          </button>
          <button id="nextBtn" class="btn-primary">
            下一题
          </button>
        </div>
      </div>
    </section>

    <!-- 结果页面 -->
    <section id="resultPage" class="hidden">
      <div class="max-w-md mx-auto">
        <!-- 结果卡片 -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8 transform transition-all duration-500" id="resultCard">
          <div class="bg-gradient-to-r from-primary to-accent p-6 text-white text-center">
            <h2 class="text-2xl font-bold mb-2" id="resultTitle">你的光遇人格分析</h2>
            <p class="opacity-90" id="resultSummary">基于20道题的多维特质检测</p>
          </div>
          
          <div class="p-6">
            <!-- 雷达图容器 -->
            <div class="mb-8 w-full" style="height: 400px;">
              <canvas id="personalityRadarChart" width="600" height="400"></canvas>
            </div>
            
            <h3 class="text-xl font-bold text-center mb-4" id="resultPersonality">探索型旅人</h3>
            
            <div class="mb-6">
              <h4 class="font-medium text-gray-700 mb-2">你的核心特质：</h4>
              <p class="text-gray-600 leading-relaxed" id="resultDescription">
                你热爱探索天空王国的每一个角落，对未知充满好奇。你享受独自飞行的自由，
                也乐于帮助遇到的每一个陌生人。在光遇的世界里，你总能发现别人忽略的美景。
              </p>
            </div>
            
            <!-- top3 特质 -->
            <div class="mb-6">
              <h4 class="font-medium text-gray-700 mb-3">你的核心特质TOP3：</h4>
              <div id="topTraits" class="grid grid-cols-3 gap-3">
                <!-- 动态生成TOP3特质 -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- 深度解读 -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-8">
          <h3 class="font-bold text-lg mb-4 flex items-center">
            <i class="fa fa-lightbulb-o text-secondary mr-2"></i>
            游戏风格建议
          </h3>
          <div class="space-y-3 text-gray-600" id="deepAnalysis">
            <p>• 基于你的特质，建议多尝试探索隐藏地图和秘密通道，那里有更多惊喜等着你。</p>
            <p>• 你可以尝试带领新玩家熟悉游戏，分享你的发现，这会让你的光遇之旅更加充实。</p>
            <p>• 参与季节性活动能让你获得更多独特体验，与其他玩家共同完成挑战会很有成就感。</p>
            <p>• 尝试记录你的光遇旅程，无论是截图还是视频，都能成为珍贵的回忆。</p>
          </div>
        </div>
        
        <!-- 特质说明 -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-8">
          <h3 class="font-bold text-lg mb-4 flex items-center">
            <i class="fa fa-info-circle text-accent mr-2"></i>
            特质维度说明
          </h3>
          <div class="space-y-2 text-gray-600 text-sm max-h-60 overflow-y-auto pr-2" id="traitExplanations">
            <p><span class="font-medium text-primary">探索欲：</span>对新地图和未知区域的好奇心</p>
            <p><span class="font-medium text-primary">社交性：</span>与其他玩家互动的意愿和能力</p>
            <p><span class="font-medium text-primary">收集癖：</span>对蜡烛、翼和装饰的收集欲望</p>
            <p><span class="font-medium text-primary">助人度：</span>帮助其他玩家的意愿和频率</p>
            <p><span class="font-medium text-primary">艺术性：</span>对游戏美景和音乐的欣赏能力</p>
            <p><span class="font-medium text-primary">挑战性：</span>完成复杂任务和试炼的兴趣</p>
            <p><span class="font-medium text-primary">仪式感：</span>参与季节活动和仪式的重视程度</p>
            <p><span class="font-medium text-primary">独处倾向：</span>独自游戏的偏好程度</p>
          </div>
        </div>
        
        <!-- 分享和重新测试 -->
        <div class="space-y-4">
          <button id="shareResultBtn" class="btn-primary w-full flex items-center justify-center">
            <i class="fa fa-share-alt mr-2"></i>
            分享测试结果
          </button>
          <button id="restartBtn" class="btn-secondary w-full">
            重新测试
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- 微信分享提示 -->
  <div id="wechatShareTip" class="fixed top-0 left-0 right-0 bottom-0 bg-black/70 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl p-6 max-w-xs mx-4 text-center">
      <div class="text-primary text-3xl mb-4">
        <i class="fa fa-weixin"></i>
      </div>
      <h3 class="font-bold text-lg mb-2">分享测试结果</h3>
      <p class="text-gray-600 mb-4">
        点击右上角 <i class="fa fa-share-alt ml-1"></i> 图标，将测试结果分享给光遇好友
      </p>
      <button id="closeShareTip" class="btn-primary w-full">
        知道了
      </button>
    </div>
  </div>

  <script>
    // 雷达图维度定义
    const radarDimensions = [
      '探索欲', '社交性', '收集癖', '助人度',
      '艺术性', '挑战性', '仪式感', '独处倾向'
    ];

    // 20道光遇人格测试题目
    const questions = [
      {
        id: 1,
        text: "进入新地图时，你通常会先做什么？",
        options: [
          { id: "a", text: "四处飞行，探索所有角落", value: { 探索欲: 90, 独处倾向: 60, 艺术性: 30 } },
          { id: "b", text: "寻找其他玩家，一起探索", value: { 社交性: 90, 助人度: 80, 挑战性: 30 } },
          { id: "c", text: "优先寻找蜡烛和翼", value: { 收集癖: 90, 挑战性: 70, 探索欲: 40 } },
          { id: "d", text: "欣赏风景和音乐", value: { 艺术性: 90, 独处倾向: 80, 仪式感: 30 } }
        ]
      },
      {
        id: 2,
        text: "遇到需要帮助的陌生玩家时，你会？",
        options: [
          { id: "a", text: "主动上前帮忙", value: { 助人度: 95, 社交性: 85, 仪式感: 30 } },
          { id: "b", text: "视情况而定，不太忙就帮", value: { 助人度: 60, 独处倾向: 50, 探索欲: 40 } },
          { id: "c", text: "可能会帮忙，但希望对方先主动", value: { 社交性: 45, 独处倾向: 70, 挑战性: 30 } },
          { id: "d", text: "通常会避开，专注自己的事情", value: { 独处倾向: 90, 探索欲: 80, 收集癖: 40 } }
        ]
      },
      {
        id: 3,
        text: "对于季节活动，你更倾向于？",
        options: [
          { id: "a", text: "完成所有任务，收集全部物品", value: { 收集癖: 95, 挑战性: 85, 仪式感: 80 } },
          { id: "b", text: "参与社交活动，和其他玩家互动", value: { 社交性: 90, 仪式感: 80, 助人度: 50 } },
          { id: "c", text: "只完成感兴趣的部分", value: { 艺术性: 70, 独处倾向: 60, 探索欲: 40 } },
          { id: "d", text: "不太关注，按自己节奏玩", value: { 独处倾向: 85, 探索欲: 80, 艺术性: 50 } }
        ]
      },
      {
        id: 4,
        text: "你更喜欢哪种游戏方式？",
        options: [
          { id: "a", text: "独自探索，享受宁静", value: { 独处倾向: 95, 探索欲: 90, 艺术性: 80 } },
          { id: "b", text: "和固定好友一起玩", value: { 社交性: 90, 助人度: 80, 仪式感: 50 } },
          { id: "c", text: "加入陌生人，认识新朋友", value: { 社交性: 95, 助人度: 90, 挑战性: 40 } },
          { id: "d", text: "专注完成目标，收集物品", value: { 收集癖: 95, 挑战性: 90, 探索欲: 40 } }
        ]
      },
      {
        id: 5,
        text: "面对游戏中的挑战（如暴风眼），你会？",
        options: [
          { id: "a", text: "反复尝试直到成功", value: { 挑战性: 95, 收集癖: 90, 独处倾向: 50 } },
          { id: "b", text: "寻找队友一起完成", value: { 社交性: 90, 挑战性: 80, 助人度: 50 } },
          { id: "c", text: "先了解攻略再尝试", value: { 挑战性: 70, 探索欲: 50, 独处倾向: 60 } },
          { id: "d", text: "觉得太难就暂时放弃", value: { 艺术性: 70, 独处倾向: 60, 仪式感: 30 } }
        ]
      },
      {
        id: 6,
        text: "你会花时间拍摄光遇的截图或视频吗？",
        options: [
          { id: "a", text: "经常拍摄，记录美好瞬间", value: { 艺术性: 95, 仪式感: 85, 探索欲: 80 } },
          { id: "b", text: "偶尔会拍特别美的场景", value: { 艺术性: 70, 探索欲: 50, 社交性: 30 } },
          { id: "c", text: "很少，更专注于游戏本身", value: { 收集癖: 70, 挑战性: 60, 独处倾向: 50 } },
          { id: "d", text: "从不，觉得浪费时间", value: { 挑战性: 70, 收集癖: 60, 社交性: 30 } }
        ]
      },
      {
        id: 7,
        text: "你对蜡烛和翼的态度是？",
        options: [
          { id: "a", text: "尽可能收集所有，追求毕业", value: { 收集癖: 95, 挑战性: 90, 仪式感: 50 } },
          { id: "b", text: "适量收集，够用就好", value: { 探索欲: 70, 社交性: 60, 艺术性: 50 } },
          { id: "c", text: "不太在意，随缘收集", value: { 艺术性: 70, 独处倾向: 60, 社交性: 30 } },
          { id: "d", text: "主要用于和朋友互动", value: { 社交性: 90, 助人度: 95, 仪式感: 50 } }
        ]
      },
      {
        id: 8,
        text: "你如何看待新玩家？",
        options: [
          { id: "a", text: "乐于指导，带他们熟悉游戏", value: { 助人度: 95, 社交性: 90, 仪式感: 50 } },
          { id: "b", text: "保持距离，不主动干涉", value: { 独处倾向: 70, 探索欲: 60, 艺术性: 50 } },
          { id: "c", text: "看心情，有时会帮忙", value: { 社交性: 50, 助人度: 50, 独处倾向: 60 } },
          { id: "d", text: "觉得他们会拖慢进度", value: { 挑战性: 70, 收集癖: 60, 独处倾向: 40 } }
        ]
      },
      {
        id: 9,
        text: "你最喜欢光遇的哪个方面？",
        options: [
          { id: "a", text: "精美的画面和音乐", value: { 艺术性: 95, 独处倾向: 90, 探索欲: 80 } },
          { id: "b", text: "与其他玩家的互动", value: { 社交性: 95, 助人度: 90, 仪式感: 50 } },
          { id: "c", text: "探索未知的地图", value: { 探索欲: 95, 挑战性: 80, 收集癖: 50 } },
          { id: "d", text: "完成任务的成就感", value: { 挑战性: 95, 收集癖: 90, 仪式感: 50 } }
        ]
      },
      {
        id: 10,
        text: "你会为了获得特定物品而多次重复同一任务吗？",
        options: [
          { id: "a", text: "会，直到获得为止", value: { 收集癖: 95, 挑战性: 90, 独处倾向: 50 } },
          { id: "b", text: "尝试几次，不行就放弃", value: { 挑战性: 70, 探索欲: 50, 社交性: 30 } },
          { id: "c", text: "很少，觉得重复很枯燥", value: { 艺术性: 70, 社交性: 50, 独处倾向: 60 } },
          { id: "d", text: "会找朋友帮忙一起完成", value: { 社交性: 90, 助人度: 80, 挑战性: 50 } }
        ]
      },
      {
        id: 11,
        text: "在游戏中遇到优美的风景，你会？",
        options: [
          { id: "a", text: "停下来欣赏，可能会停留很久", value: { 艺术性: 95, 独处倾向: 90, 仪式感: 50 } },
          { id: "b", text: "拍照留念，然后继续前进", value: { 艺术性: 80, 探索欲: 80, 社交性: 30 } },
          { id: "c", text: "告诉朋友，邀请他们一起来看", value: { 社交性: 90, 艺术性: 80, 助人度: 50 } },
          { id: "d", text: "很少留意，专注于目标", value: { 收集癖: 70, 挑战性: 80, 独处倾向: 30 } }
        ]
      },
      {
        id: 12,
        text: "你更倾向于和什么样的玩家成为好友？",
        options: [
          { id: "a", text: "熟悉游戏的老玩家，能提供帮助", value: { 社交性: 60, 挑战性: 80, 收集癖: 50 } },
          { id: "b", text: "志同道合的玩家，能一起探索", value: { 探索欲: 90, 社交性: 85, 艺术性: 50 } },
          { id: "c", text: "新玩家，可以一起成长", value: { 助人度: 95, 社交性: 90, 仪式感: 50 } },
          { id: "d", text: "不太在意，随缘添加", value: { 独处倾向: 70, 艺术性: 50, 探索欲: 60 } }
        ]
      },
      {
        id: 13,
        text: "你对游戏中的音乐和乐器态度是？",
        options: [
          { id: "a", text: "非常喜欢，会学习演奏", value: { 艺术性: 95, 仪式感: 90, 社交性: 80 } },
          { id: "b", text: "喜欢听，但自己不演奏", value: { 艺术性: 80, 独处倾向: 60, 社交性: 50 } },
          { id: "c", text: "一般，不太关注", value: { 探索欲: 60, 收集癖: 50, 挑战性: 50 } },
          { id: "d", text: "不太在意，更关注其他内容", value: { 挑战性: 70, 收集癖: 80, 探索欲: 30 } }
        ]
      },
      {
        id: 14,
        text: "你会花时间研究游戏攻略吗？",
        options: [
          { id: "a", text: "经常研究，追求最优解", value: { 挑战性: 95, 收集癖: 90, 独处倾向: 50 } },
          { id: "b", text: "遇到困难时才会查阅", value: { 挑战性: 70, 探索欲: 50, 社交性: 50 } },
          { id: "c", text: "很少，更喜欢自己探索", value: { 探索欲: 95, 艺术性: 80, 独处倾向: 60 } },
          { id: "d", text: "从不，会向朋友请教", value: { 社交性: 90, 助人度: 80, 仪式感: 30 } }
        ]
      },
      {
        id: 15,
        text: "对于游戏中的社交动作，你会？",
        options: [
          { id: "a", text: "收集并经常使用", value: { 社交性: 95, 仪式感: 90, 助人度: 80 } },
          { id: "b", text: "收集但很少使用", value: { 收集癖: 80, 社交性: 50, 独处倾向: 60 } },
          { id: "c", text: "只收集喜欢的，偶尔使用", value: { 艺术性: 80, 社交性: 50, 仪式感: 60 } },
          { id: "d", text: "不太在意，很少使用", value: { 独处倾向: 90, 探索欲: 80, 挑战性: 50 } }
        ]
      },
      {
        id: 16,
        text: "你更喜欢白天还是夜晚的地图？",
        options: [
          { id: "a", text: "夜晚，喜欢星空和宁静", value: { 艺术性: 95, 独处倾向: 90, 仪式感: 50 } },
          { id: "b", text: "白天，视野更好，方便探索", value: { 探索欲: 95, 挑战性: 80, 收集癖: 50 } },
          { id: "c", text: "无所谓，看心情", value: { 社交性: 60, 助人度: 50, 艺术性: 50 } },
          { id: "d", text: "喜欢有特殊天气的时刻", value: { 仪式感: 90, 艺术性: 90, 探索欲: 50 } }
        ]
      },
      {
        id: 17,
        text: "你会主动参与游戏中的集体活动吗？",
        options: [
          { id: "a", text: "积极参与，喜欢热闹", value: { 社交性: 95, 仪式感: 90, 助人度: 80 } },
          { id: "b", text: "偶尔参与，看活动内容", value: { 社交性: 60, 仪式感: 50, 探索欲: 50 } },
          { id: "c", text: "很少参与，更喜欢独自活动", value: { 独处倾向: 90, 艺术性: 80, 探索欲: 50 } },
          { id: "d", text: "只参与能获得奖励的活动", value: { 收集癖: 95, 挑战性: 80, 仪式感: 30 } }
        ]
      },
      {
        id: 18,
        text: "你如何处理游戏中的错误或挫折？",
        options: [
          { id: "a", text: "保持耐心，继续尝试", value: { 挑战性: 95, 独处倾向: 60, 收集癖: 50 } },
          { id: "b", text: "寻求朋友帮助", value: { 社交性: 90, 助人度: 95, 挑战性: 50 } },
          { id: "c", text: "暂时放下，稍后再试", value: { 探索欲: 60, 艺术性: 50, 独处倾向: 60 } },
          { id: "d", text: "可能会感到沮丧，需要休息", value: { 艺术性: 70, 仪式感: 50, 社交性: 30 } }
        ]
      },
      {
        id: 19,
        text: "你对游戏中的装饰和外观有多重视？",
        options: [
          { id: "a", text: "非常重视，追求独特外观", value: { 收集癖: 95, 艺术性: 90, 社交性: 80 } },
          { id: "b", text: "比较重视，会选择喜欢的搭配", value: { 艺术性: 80, 收集癖: 80, 仪式感: 50 } },
          { id: "c", text: "不太重视，更关注游戏体验", value: { 探索欲: 90, 挑战性: 80, 独处倾向: 50 } },
          { id: "d", text: "完全不在意，能用就行", value: { 挑战性: 70, 助人度: 50, 探索欲: 50 } }
        ]
      },
      {
        id: 20,
        text: "你希望从光遇中获得什么？",
        options: [
          { id: "a", text: "宁静和放松", value: { 艺术性: 95, 独处倾向: 90, 仪式感: 80 } },
          { id: "b", text: "社交和友谊", value: { 社交性: 95, 助人度: 90, 仪式感: 50 } },
          { id: "c", text: "成就感和完成目标", value: { 挑战性: 95, 收集癖: 90, 探索欲: 50 } },
          { id: "d", text: "探索和发现的乐趣", value: { 探索欲: 95, 艺术性: 90, 独处倾向: 50 } }
        ]
      }
    ];

    // 结果类型数据
    const resultTypes = [
      {
        type: "explorer",
        title: "探索型旅人",
        mainTraits: ["探索欲", "艺术性", "独处倾向"],
        description: "你是天空王国的好奇探索者，对每一个角落都充满兴趣。你喜欢独自飞行，欣赏王国的美景，常常能发现别人忽略的细节和秘密。对你来说，光遇的乐趣在于发现未知和享受宁静。",
        analysis: [
          "• 建议多探索隐藏地图和秘密通道，那里有更多惊喜等着你。",
          "• 尝试记录你的发现，无论是截图还是笔记，都能成为珍贵的回忆。",
          "• 偶尔可以带领新玩家探索，分享你的发现会带来不同的乐趣。",
          "• 季节活动中的新地图是你不容错过的探索目标。"
        ],
        color: "from-blue-500 to-cyan-500"
      },
      {
        type: "socializer",
        title: "社交型旅人",
        mainTraits: ["社交性", "助人度", "仪式感"],
        description: "你是天空王国的友好使者，喜欢与其他玩家互动，乐于帮助他人。你享受和朋友一起飞行、探索和完成任务的时光，对季节性活动和集体仪式充满热情。对你来说，光遇的魅力在于连接和分享。",
        analysis: [
          "• 参与更多社交活动，认识新朋友，扩大你的光遇社交圈。",
          "• 尝试组织小型活动，邀请好友一起完成挑战或欣赏风景。",
          "• 新玩家会从你的帮助中获益良多，你的耐心指导很有价值。",
          "• 季节性仪式和活动是你展示社交能力的好机会。"
        ],
        color: "from-yellow-500 to-orange-500"
      },
      {
        type: "collector",
        title: "收集型旅人",
        mainTraits: ["收集癖", "挑战性", "仪式感"],
        description: "你是天空王国的执着收藏家，热衷于收集蜡烛、翼和各种装饰。你有很强的目标感，喜欢完成各种任务和挑战，追求游戏的完整性。对你来说，光遇的乐趣在于达成目标和拥有全部。",
        analysis: [
          "• 制定收集计划，优先完成对你最重要的目标。",
          "• 不要忽略游戏的其他乐趣，偶尔放慢脚步欣赏风景。",
          "• 可以和其他收集爱好者交流心得，分享技巧。",
          "• 季节性物品是你收藏的重点，提前做好准备。"
        ],
        color: "from-purple-500 to-pink-500"
      },
      {
        type: "artist",
        title: "艺术型旅人",
        mainTraits: ["艺术性", "仪式感", "独处倾向"],
        description: "你是天空王国的敏感艺术家，被游戏的美景和音乐深深吸引。你喜欢在游戏中寻找美的瞬间，可能会花时间拍照、演奏音乐或只是静静欣赏。对你来说，光遇是一个可以沉浸其中的艺术世界。",
        analysis: [
          "• 尝试使用游戏中的乐器，创作自己的音乐。",
          "• 记录下游戏中美丽的瞬间，分享给其他玩家。",
          "• 参与与艺术相关的社区活动，展示你的作品。",
          "• 留意游戏中的天气变化和特殊时刻，那里有独特的美。"
        ],
        color: "from-green-500 to-teal-500"
      },
      {
        type: "balanced",
        title: "均衡型旅人",
        mainTraits: ["探索欲", "社交性", "艺术性"],
        description: "你是天空王国的全面体验者，能够平衡游戏的各个方面。你享受探索的乐趣，也喜欢与他人互动，同时能欣赏游戏的艺术之美。对你来说，光遇是一个可以根据心情随时切换玩法的多元世界。",
        analysis: [
          "• 继续保持开放的心态，尝试游戏的各种玩法。",
          "• 可以根据心情调整游戏方式，有时独自探索，有时与朋友相聚。",
          "• 你的多元化视角可以帮助不同类型的玩家相互理解。",
          "• 尝试在不同玩法之间找到平衡，全面体验游戏的魅力。"
        ],
        color: "from-indigo-500 to-blue-500"
      }
    ];

    // 全局变量 - 调整分值范围和权重
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let traitScores = {}; // 存储各维度得分
    const MIN_SCORE = 30; // 基础分
    const MAX_SCORE = 100; // 最高得分
    const MAX_QUESTION_CONTRIBUTION = 15; // 每道题最高贡献分值
    const PENALTY_FACTOR = 0.3; // 扣分系数（未选中选项的权重百分比）

    // 初始化特质得分
    radarDimensions.forEach(dimension => {
      traitScores[dimension] = MIN_SCORE;
    });

    // DOM元素
    const loader = document.getElementById('loader');
    const welcomePage = document.getElementById('welcomePage');
    const testPage = document.getElementById('testPage');
    const resultPage = document.getElementById('resultPage');
    const startTestBtn = document.getElementById('startTestBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const restartBtn = document.getElementById('restartBtn');
    const shareBtn = document.getElementById('shareBtn');
    const shareResultBtn = document.getElementById('shareResultBtn');
    const wechatShareTip = document.getElementById('wechatShareTip');
    const closeShareTip = document.getElementById('closeShareTip');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const currentQuestion = document.getElementById('currentQuestion');
    const totalQuestions = document.getElementById('totalQuestions');
    const progressBar = document.getElementById('progressBar');
    const header = document.getElementById('header');
    const resultCard = document.getElementById('resultCard');
    const topTraits = document.getElementById('topTraits');

    // 页面加载完成后执行
    window.addEventListener('DOMContentLoaded', () => {
      // 模拟加载过程
      setTimeout(() => {
        loader.classList.add('opacity-0');
        setTimeout(() => {
          loader.classList.add('hidden');
        }, 300);
      }, 1000);

      // 监听滚动事件，改变导航栏样式
      window.addEventListener('scroll', () => {
        if (window.scrollY > 10) {
          header.classList.add('shadow');
          header.classList.remove('bg-white/80');
          header.classList.add('bg-white');
        } else {
          header.classList.remove('shadow');
          header.classList.add('bg-white/80');
          header.classList.remove('bg-white');
        }
      });
    });

    // 开始测试按钮点击事件
    startTestBtn.addEventListener('click', () => {
      welcomePage.classList.add('hidden');
      testPage.classList.remove('hidden');
      testPage.classList.add('block');
      renderCurrentQuestion();
    });

    // 上一题按钮点击事件
    prevBtn.addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderCurrentQuestion();
        
        // 更新按钮状态
        nextBtn.textContent = '下一题';
        if (currentQuestionIndex === 0) {
          prevBtn.disabled = true;
          prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
      }
    });

    // 下一题按钮点击事件
    nextBtn.addEventListener('click', () => {
      const selectedOption = document.querySelector('input[name="option"]:checked');
      if (!selectedOption) {
        alert('请选择一个选项');
        return;
      }

      // 保存答案
      userAnswers[currentQuestionIndex] = selectedOption.value;
      
      // 更新特质分数（包含加分和扣分）
      updateTraitScores(currentQuestionIndex, selectedOption.value);

      if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        renderCurrentQuestion();
        
        // 更新按钮状态
        prevBtn.disabled = false;
        prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        
        if (currentQuestionIndex === questions.length - 1) {
          nextBtn.textContent = '查看结果';
        }
      } else {
        // 所有问题完成，显示结果
        testPage.classList.add('hidden');
        resultPage.classList.remove('hidden');
        resultPage.classList.add('block');
        showResults();
      }
    });

    // 重新测试按钮点击事件
    restartBtn.addEventListener('click', () => {
      // 重置测试状态
      currentQuestionIndex = 0;
      userAnswers = [];
      radarDimensions.forEach(dimension => {
        traitScores[dimension] = MIN_SCORE;
      });
      
      // 显示欢迎页面
      resultPage.classList.add('hidden');
      welcomePage.classList.remove('hidden');
      welcomePage.classList.add('block');
    });

    // 分享按钮点击事件
    shareBtn.addEventListener('click', () => {
      wechatShareTip.classList.remove('hidden');
    });
    
    shareResultBtn.addEventListener('click', () => {
      wechatShareTip.classList.remove('hidden');
    });
    
    closeShareTip.addEventListener('click', () => {
      wechatShareTip.classList.add('hidden');
    });

    // 渲染当前问题
    function renderCurrentQuestion() {
      const question = questions[currentQuestionIndex];
      questionText.textContent = question.text;
      currentQuestion.textContent = question.id;
      totalQuestions.textContent = questions.length;
      
      // 更新进度条
      const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
      progressBar.style.width = `${progress}%`;
      
      // 清空选项容器
      optionsContainer.innerHTML = '';
      
      // 生成选项
      question.options.forEach(option => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'relative';
        
        const inputId = `q${question.id}opt${option.id}`;
        const isSelected = userAnswers[currentQuestionIndex] === option.id;
        
        optionDiv.innerHTML = `
          <input type="radio" id="${inputId}" name="option" value="${option.id}" 
                 class="peer sr-only" ${isSelected ? 'checked' : ''}>
          <label for="${inputId}" class="block w-full p-4 border border-gray-200 rounded-xl cursor-pointer
                    transition-all duration-200 peer-checked:border-primary peer-checked:bg-primary/5
                    hover:border-primary/50">
            <span class="font-medium">${option.text}</span>
          </label>
          <div class="absolute top-5 right-4 text-primary opacity-0 peer-checked:opacity-100 transition-opacity">
            <i class="fa fa-check-circle"></i>
          </div>
        `;
        
        optionsContainer.appendChild(optionDiv);
      });
    }

    // 分值计算逻辑（包含加分和扣分机制）
    function updateTraitScores(questionIndex, selectedOptionId) {
      const question = questions[questionIndex];
      const selectedOption = question.options.find(opt => opt.id === selectedOptionId);
      const unselectedOptions = question.options.filter(opt => opt.id !== selectedOptionId);
      
      // 1. 为选中的选项加分
      if (selectedOption && selectedOption.value) {
        Object.keys(selectedOption.value).forEach(trait => {
          const weight = selectedOption.value[trait] / 100; // 0-1之间的权重
          const questionScore = weight * MAX_QUESTION_CONTRIBUTION;
          
          // 累加分数，确保不超过满分
          traitScores[trait] = Math.min(Math.round(traitScores[trait] + questionScore), MAX_SCORE);
        });
      }
      
      // 2. 为未选中的选项扣分（针对与选中选项相悖的特质）
      unselectedOptions.forEach(option => {
        if (option.value) {
          Object.keys(option.value).forEach(trait => {
            // 只有当该特质在选中选项中权重较低时才扣分
            const selectedWeight = selectedOption ? (selectedOption.value[trait] || 0) : 0;
            const unselectedWeight = option.value[trait];
            
            // 如果未选中选项的该特质权重高于选中选项，则扣分
            if (unselectedWeight > selectedWeight + 20) { // 差异阈值：20
              const weight = unselectedWeight / 100;
              const penalty = weight * MAX_QUESTION_CONTRIBUTION * PENALTY_FACTOR;
              
              // 扣分，确保不低于基础分
              traitScores[trait] = Math.max(Math.round(traitScores[trait] - penalty), MIN_SCORE);
            }
          });
        }
      });
      
      // 3. 特殊处理：对立特质的额外扣分
      applyOpposingTraitPenalties(selectedOption);
    }

    // 对立特质额外扣分（增强性格区分度）
    function applyOpposingTraitPenalties(selectedOption) {
      // 定义对立特质对
      const opposingTraits = [
        { positive: '社交性', negative: '独处倾向' },
        { positive: '探索欲', negative: '收集癖' },
        { positive: '挑战性', negative: '艺术性' },
        { positive: '助人度', negative: '仪式感' }
      ];
      
      if (selectedOption && selectedOption.value) {
        opposingTraits.forEach(pair => {
          // 如果选中选项强调了某个特质，则对其对立特质进行额外扣分
          if (selectedOption.value[pair.positive] >= 70) { // 高权重强调
            const penalty = MAX_QUESTION_CONTRIBUTION * 0.2; // 额外扣20%
            traitScores[pair.negative] = Math.max(Math.round(traitScores[pair.negative] - penalty), MIN_SCORE);
          }
          // 如果选中选项弱化了某个特质，则对其对立特质进行适当加分
          else if (selectedOption.value[pair.positive] <= 30) { // 低权重弱化
            const bonus = MAX_QUESTION_CONTRIBUTION * 0.1; // 额外加10%
            traitScores[pair.negative] = Math.min(Math.round(traitScores[pair.negative] + bonus), MAX_SCORE);
          }
        });
      }
    }

    // 显示测试结果
    function showResults() {
      // 确定最匹配的结果类型
      const resultType = determineResultType();
      
      // 更新结果页面内容
      document.getElementById('resultPersonality').textContent = resultType.title;
      document.getElementById('resultDescription').textContent = resultType.description;
      document.querySelector('#resultCard .bg-gradient-to-r').className = `bg-gradient-to-r ${resultType.color} p-6 text-white text-center`;
      
      // 更新深度分析
      const deepAnalysisEl = document.getElementById('deepAnalysis');
      deepAnalysisEl.innerHTML = '';
      resultType.analysis.forEach(item => {
        const p = document.createElement('p');
        p.innerHTML = item;
        deepAnalysisEl.appendChild(p);
      });
      
      // 显示TOP3特质
      showTopTraits();
      
      // 绘制雷达图
      drawRadarChart();
      
      // 添加结果卡片动画
      setTimeout(() => {
        resultCard.classList.add('scale-100');
        resultCard.classList.remove('scale-95', 'opacity-0');
      }, 100);
    }

    // 确定最匹配的结果类型
    function determineResultType() {
      let maxScore = -1;
      let bestMatch = resultTypes[0];
      
      resultTypes.forEach(type => {
        let total = 0;
        type.mainTraits.forEach(trait => {
          total += traitScores[trait];
        });
        
        if (total > maxScore) {
          maxScore = total;
          bestMatch = type;
        }
      });
      
      return bestMatch;
    }

    // 显示TOP3特质
    function showTopTraits() {
      topTraits.innerHTML = '';
      
      // 按分数排序特质
      const sortedTraits = Object.keys(traitScores).sort((a, b) => traitScores[b] - traitScores[a]);
      
      // 取前三名
      const top3 = sortedTraits.slice(0, 3);
      
      top3.forEach(trait => {
        const traitDiv = document.createElement('div');
        traitDiv.className = 'bg-neutral rounded-lg p-3 text-center';
        
        // 根据分数添加不同颜色标识
        let scoreColor = 'text-primary';
        if (traitScores[trait] >= 90) scoreColor = 'text-red-500';
        else if (traitScores[trait] >= 70) scoreColor = 'text-orange-500';
        else if (traitScores[trait] >= 50) scoreColor = 'text-green-500';
        
        traitDiv.innerHTML = `
          <div class="text-primary font-medium mb-1">${trait}</div>
          <div class="text-xs ${scoreColor} font-bold">${traitScores[trait]}分</div>
        `;
        topTraits.appendChild(traitDiv);
      });
    }

    // 绘制雷达图 - 保持5层
    function drawRadarChart() {
      const ctx = document.getElementById('personalityRadarChart').getContext('2d');
      
      // 准备数据
      const labels = radarDimensions;
      const data = labels.map(label => traitScores[label]);
      
      // 销毁已存在的图表
      if (window.radarChart) {
        window.radarChart.destroy();
      }
      
      // 创建新图表
      window.radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: labels,
          datasets: [{
            label: '你的特质分数',
            data: data,
            backgroundColor: 'rgba(74, 144, 226, 0.2)',
            borderColor: 'rgba(74, 144, 226, 1)',
            pointBackgroundColor: 'rgba(74, 144, 226, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(74, 144, 226, 1)'
          }]
        },
        options: {
          scales: {
            r: {
              angleLines: {
                display: true
              },
              suggestedMin: 0,
              suggestedMax: 100,
              ticks: {
                stepSize: 25,
                display: true
              },
              grid: {
                count: 5
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }
  </script>
</body>
</html>